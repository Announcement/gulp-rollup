{"version":3,"names":[],"mappings":"","sources":["index.js"],"sourcesContent":["import through from 'through2'\nimport rollup from 'rollup'\n\nimport * as valid from './valid'\n\nimport error from './error'\nimport trace from './trace'\nimport getRollupConfiguration from './getRollupConfiguration'\nimport getGenerateConfiguration from './getGenerateConfiguration'\n\nexport default function (options) {\n  var cache\n\n  cache = {}\n\n  return through.obj(obj)\n\n  function obj (file, encoding, callback) {\n    var configuration\n\n    configuration = {}\n\n    configuration.rollup = getRollupConfiguration(file, cache, options)\n    configuration.generate = getGenerateConfiguration(file, options)\n\n    rollup.rollup(configuration.rollup).then(compile).catch(error(callback))\n\n    function compile (bundle) {\n      var result\n\n      result = bundle.generate(configuration.generate)\n      cache[file.path] = bundle\n\n      trace(result.map, file)\n      debuffer(result)\n\n      validate() && success()\n    }\n\n    function debuffer (it) {\n      file.contents = Buffer.from(it.code)\n    }\n\n    function success () {\n      callback(null, file)\n    }\n\n    function validate (it) {\n      return valid.string(file.contents)\n    }\n  }\n}\n"],"file":"index.js"}